<html>
	<head>
		<meta name="description" content="">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <meta http-equiv="cleartype" content="on">
		
		<style type="text/css">
			body {
				margin:auto;
				padding:0;
				width:100%;
				height:100%;
			}
			
			#canvas {
				border: 1px solid #333;
				/*width: 90%;
				height: 90%;*/
				margin: auto;
				float: left;
			}
			
		</style>

	</head>
	<body onmousedown="return false;" onLoad="init()">
        
        <canvas id="canvas" width="350" height="490"></canvas>
        <div id="debug"></div>
        
		<script type="text/javascript">
			
			var radius = 10;
			var canvas = document.getElementById('canvas');
			var debug = document.getElementById('debug');
			
			var context = canvas.getContext("2d");
			
			var startX = canvas.width / 2;
			var startY = canvas.height - radius -5;
			
			var centerX = canvas.width / 2;
			var centerY = canvas.height - radius -5;
			
			var boundryX = canvas.width;
			var boundryY = canvas.height;
			
			var blockSize = 20;
			
			var newX=0, newY=0;
			var moveX = 0, moveY = 0;
			
			var blockerArray = new Array();
			blockerArray = [{"x":10, "y":10, "dir":1}, {"x":50, "y":10, "dir":-1}, {"x":50, "y":10, "dir":1}, {"x":50, "y":50, "dir":-1}];
			
			
			function init() {
				drawCircle(startX, startY);
				drawBlockers();
				if (window.DeviceOrientationEvent) {
					window.addEventListener('deviceorientation', function(eventData) {
						var LR = eventData.gamma;
				    	var FB = eventData.beta;
				    	var DIR = eventData.alpha;
				    	deviceOrientationHandler(LR, FB, DIR);
				    }, false);
				} 
				else if (window.OrientationEvent) {
					window.addEventListener('MozOrientation', mozDevOrientHandler, false);
				}  
			}
			
			function deviceOrientationHandler(LR, FB, DIR) {
				// Set x and y move amounts
				moveX = Math.round(LR);  // - moveX;
				moveY = Math.round(FB);  // - moveY;
				
				// run moveBall() to update ball center x and y
				moveBall(moveX,moveY);
			}
			
			function moveBall(moveX,moveY){  
				// Calculate the ball move
				moveX = moveX / 20;
				moveY = moveY / 20;
				
				// Make new center points	
				newX = centerX + moveX;
				newY = centerY + moveY;
				
				
				// Check if ball hit boundary --> start over
				if(newX - radius < 0){ 
					debug.innerHTML = "crash";
					crash();
					}
				if(newX + radius > boundryX){ 
				debug.innerHTML = "crash";
					crash();
					}
				if(newY - radius < 0) 
					crash();
				if(newY + radius > boundryY) 
					newY = boundryY - radius;
					
				//check boundaries for each blocker
				canMoveBall(newX, newY);
				
				moveBlocker(blockerArray);
				drawCircle(newX, newY);
		        
		        
			}
			
			function canMoveBall(x, y) {
				for (var i = 0; i < blockerArray.length; i++) {
					if (blockerArray[i].x -) {
						
					}
				}
			}
			
			function crash(){
				debug.innerHTML = "death";
				// Check if ball hit a side or top --> reset and run main()
				//context.clearRect ( 0 , 0 , boundryX , boundryY );
				newX = startX;
				newY = startY;
				//context.beginPath();
				//drawCircle(startX, startY);
				redrawCanvas();
			}
			
			function redrawCanvas(){
				context.clearRect ( 0 , 0 , boundryX , boundryY );
				drawCircle(newX, newY);
				drawBlockers();
				
			}
			
			function drawCircle(x, y){
				context.beginPath();
				centerX = x;
				centerY = y;
		        context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
		        context.fillStyle = "#8ED6FF";
		        context.fill();
		        context.lineWidth = 1;
		        context.strokeStyle = "#0080c9";
		        context.stroke();
		        drawBlocker(blockerArray);
			}
			
			function moveBlocker(blockerArray) {
				//for (var i = 0; i < blockerArray.length; i++) {
					// Update each blocker position
				//}
				// Check Collisions to see if blockers pushed the ball (blocker boundaries are less than the circlex+radius)
				checkCollisions();
			}
			
			function drawBlocker(blockerArray) {
				context.clearRect ( 0 , 0 , boundryX , boundryY );
				for (var i = 0; i < blockerArray.length; i++) {
					
			        context.fillRect(blockerArray[i].x, blockerArray[i].y, 10, 10);
			        context.fillStyle = "#8ED6FF";
			        context.fill();
			        context.lineWidth = 1;
			        context.strokeStyle = "#0080c9";
			        context.stroke();
					
				}
			}
			
				
		</script>
            
	</body>
</html>